document.addEventListener('DOMContentLoaded', function() {
	var linkCss = document.createElement('link');
	linkCss.setAttribute('rel', 'stylesheet');
	linkCss.setAttribute('type', 'text/css');
	linkCss.setAttribute('href', 'https://raw.cachefly.998111.xyz/zengchaoqun0625/movies/main/css/guigui-PictureBlackbox.min.css');
	document.head.appendChild(linkCss);
	var PicBlackbox = document.querySelectorAll('#guigui-PicBlackbox');
	PicBlackbox.forEach(function(dom) {
		dom.addEventListener('click', function(event) {
			event.preventDefault();
			var mainBoxNum = document.querySelectorAll('.guigui-mainBox').length;
			if (mainBoxNum > 0) {
				alert('每次只能创建一次dom元素啊亲~');
				return false;
			}
			if (this.getAttribute('data-pic') === '') {
				alert('检测到你标签里的data-pic属性未添加图片路径');
				return false;
			}
			var guiguiMainBox = createElementWithClass('div', 'guigui-mainBox');
			var insideDiv = createElementWithClass('div', 'guigui-fadeOutDiv');
			var masking = createElementWithClass('div', 'guigui-masking');
			var newImg = createElementWithClass('img', 'guigui-fadeOutPic');
			var newP = createElementWithClass('p', 'guigui-fadeOutText');
			var delDom = createElementWithClass('i', 'guigui-delDom');
			var picLink = this.getAttribute('data-pic');
			var zdyText = this.getAttribute('data-text');
			if (picLink === null) {
				alert('检测到你标签里未添加 data-pic 属性');
				return false;
			}
			delDom.textContent = '×';
			newImg.src = picLink;
			newP.textContent = zdyText;
			var children = [newImg, delDom];
			if (zdyText !== null) {
				newImg.alt = zdyText;
				children.splice(1, 0, newP);
			}
			insideDiv.append.apply(insideDiv, children);
			guiguiMainBox.append(insideDiv, masking);
			document.body.appendChild(guiguiMainBox);
			var pic = document.querySelector('.guigui-fadeOutPic');
			var fadeOutDiv = document.querySelector('.guigui-fadeOutDiv');
			var img = new Image();
			img.onload = function() {
				var w = img.width;
				var h = img.height;
				var orientation = w > h ? 1 : 0;
				if (orientation) {
					pic.style.width = "100%";
					fadeOutDiv.classList.add('Div-w');
				} else {
					pic.style.height = "100%";
					fadeOutDiv.classList.add('Div-h');
				}
			};
			img.src = picLink;
			var mainBox = document.querySelector('.guigui-mainBox');
			mainBox.classList.add('guigui-fadeIn');
			var guiguiTextCopy = document.querySelector('.guigui-fadeOutText');
			if (guiguiTextCopy) {
				var alertBox = null;
				guiguiTextCopy.addEventListener('click', async function() {
					var text = guiguiTextCopy.textContent;

					function showSimpleAlert(text) {
						alertBox.textContent = text;
					}
					if (alertBox) {
						showSimpleAlert(text);
					} else {
						alertBox = document.createElement('div');
						alertBox.classList.add('guigui-simpleAlert');
						try {
							await navigator.clipboard.writeText(text);
							showSimpleAlert('复制成功');
						} catch (err) {
							alert('复制失败');
						}
						document.body.appendChild(alertBox);
						setTimeout(function() {
							alertBox.style.left = 0;
						}, 50);
						setTimeout(function() {
							alertBox.style.left = '-100%';
							setTimeout(function() {
								alertBox.remove();
								alertBox = null;
							}, 500);
						}, 3050);
					}
				});
			}
			var guiguiImgDel = document.querySelector('.guigui-masking');
			var guiguidelDom = document.querySelector('.guigui-delDom');
			guiguiImgDel.addEventListener('click', removeElement);
			guiguidelDom.addEventListener('click', removeElement);

			function removeElement() {
				var classList = mainBox.classList;
				classList.remove('guigui-fadeIn');
				classList.add('guigui-fadeOut');
				setTimeout(function() {
					return mainBox.remove();
				}, 350);
			}
		});
	});

	function createElementWithClass(tagName, className) {
		var ele = document.createElement(tagName);
		if (className) {
			ele.classList.add(className);
		}
		return ele;
	}
});